# Dialog System / –î–∏–∞–ª–æ–≥–æ–≤–∞—è –°–∏—Å—Ç–µ–º–∞

–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è Godot 4.5, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è –≤–µ—Ç–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤, —É—Å–ª–æ–≤–∏—è, —Å–æ–±—ã—Ç–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–∏—Å—Ç–µ–º–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
DialogoeSystem/
‚îú‚îÄ‚îÄ dialog_manager.gd       # –û—Å–Ω–æ–≤–Ω–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä (Autoload)
‚îú‚îÄ‚îÄ dialog_ui.gd            # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îú‚îÄ‚îÄ dialog_UI.tscn          # –°—Ü–µ–Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îú‚îÄ‚îÄ dialogs.json            # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
‚îú‚îÄ‚îÄ npc_dialog_component.gd # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è NPC
‚îî‚îÄ‚îÄ README.md               # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–Ω–∏–µ NPC —Å –¥–∏–∞–ª–æ–≥–æ–º

```gdscript
# –í–∞—à NPC –¥–æ–ª–∂–µ–Ω –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç NPCBase
extends NPCBase

func _ready():
	npc_display_name = "–¢–æ—Ä–≥–æ–≤–µ—Ü"
	starting_dialog_id = "merchant_greeting"
	super._ready()  # –í–∞–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π _ready()
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏–∞–ª–æ–≥–∞ –≤ JSON

```json
{
  "dialogs": {
	"dialog_id": {
	  "character": "–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
	  "text": "–¢–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞",
	  "choices": [
		{
		  "text": "–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞",
		  "next": "—Å–ª–µ–¥—É—é—â–∏–π_dialog_id",
		  "condition": "reputation:>=:10",
		  "event": "–∏–º—è_—Å–æ–±—ã—Ç–∏—è",
		  "params": {"–∫–ª—é—á": "–∑–Ω–∞—á–µ–Ω–∏–µ"}
		}
	  ],
	  "auto_events": ["—Å–æ–±—ã—Ç–∏–µ1", "—Å–æ–±—ã—Ç–∏–µ2"]
	}
  }
}
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ UI –≤ —Å—Ü–µ–Ω—É

–î–æ–±–∞–≤—å—Ç–µ —Å—Ü–µ–Ω—É `dialog_UI.tscn` –≤ –≤–∞—à –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª —É—Ä–æ–≤–Ω—è –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### DialogManager (Autoload)

–ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–∏–∞–ª–æ–≥–æ–≤. –î–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –ª—é–±–æ–≥–æ –º–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ `DialogManager`.

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `start_dialog(dialog_id: String)` - –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–ª–æ–≥
- `process_choice(choice: Dictionary)` - –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
- `register_event(event_name: String, handler: Callable)` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è
- `trigger_event(event_name: String, params: Dictionary)` - –≤—ã–∑–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ

**–°–∏–≥–Ω–∞–ª—ã:**
- `dialog_started(dialog_id: String)` - –¥–∏–∞–ª–æ–≥ –Ω–∞—á–∞—Ç
- `dialog_ended` - –¥–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à—ë–Ω
- `dialog_event(event_name: String, params: Dictionary)` - —Å–æ–±—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞

### DialogUI (CanvasLayer)

–í–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–∏–∞–ª–æ–≥–æ–≤. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ DialogManager.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI:**
- CharacterName - –∏–º—è –≥–æ–≤–æ—Ä—è—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- DialogText - –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ (RichTextLabel, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç BBCode)
- ChoicesContainer - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞

### NPCDialogComponent (Node)

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è NPC, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –¥–∏–∞–ª–æ–≥–æ–≤—ã–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º.

**–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `npc_name: String` - –∏–º—è NPC
- `starting_dialog_id: String` - ID –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
- `greeting_dialog_id: String` - ID –¥–∏–∞–ª–æ–≥–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è (fallback)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–º –≤–æ –≤—Ä–µ–º—è –¥–∏–∞–ª–æ–≥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∫—É—Ä—Å–æ—Ä –º—ã—à–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å–∏—Å—Ç–µ–º–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### NPCBase (Interactable)

–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è NPC —Å –¥–∏–∞–ª–æ–≥–∞–º–∏. –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `Interactable`.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```gdscript
extends NPCBase

func _ready():
	npc_display_name = "–ö—É–ø–µ—Ü"
	starting_dialog_id = "merchant_greeting"
	super._ready()
```

## üí¨ –§–æ—Ä–º–∞—Ç –¥–∏–∞–ª–æ–≥–æ–≤

### –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```json
{
  "dialogs": {
	"greeting": {
	  "character": "–ì–≤–∞—Ä–¥–µ–µ—Ü",
	  "text": "–°—Ç–æ–π! –ö—Ç–æ –∏–¥—ë—Ç?",
	  "choices": [
		{
		  "text": "–î—Ä—É–≥",
		  "next": "friend_response"
		},
		{
		  "text": "–í—Ä–∞–≥!",
		  "next": "enemy_response"
		}
	  ]
	}
  }
}
```

### –£—Å–ª–æ–≤–∏—è (Conditions)

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É—Å–ª–æ–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:

```json
{
  "text": "–û—Å–æ–±–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
  "condition": "reputation:>=:10",
  "next": "special_offer"
}
```

**–§–æ—Ä–º–∞—Ç—ã —É—Å–ª–æ–≤–∏–π:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:**
   - `"variable:operator:value"`
   - –û–ø–µ—Ä–∞—Ç–æ—Ä—ã: `>`, `<`, `>=`, `<=`, `==`
   - –ü—Ä–∏–º–µ—Ä: `"gold:>:100"`, `"level:>=:5"`

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞:**
   - `"has_item:item_id"`
   - –ü—Ä–∏–º–µ—Ä: `"has_item:key"`

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–≤–µ—Å—Ç–∞:**
   - `"quest_active:quest_id"`
   - –ü—Ä–∏–º–µ—Ä: `"quest_active:main_quest_1"`

### –°–æ–±—ã—Ç–∏—è (Events)

–°–æ–±—ã—Ç–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–∏ –∏–ª–∏ —Å—Ç–∞—Ä—Ç–µ –¥–∏–∞–ª–æ–≥–∞.

**–í –≤—ã–±–æ—Ä–µ –∏–≥—Ä–æ–∫–∞:**
```json
{
  "text": "–ö—É–ø–∏—Ç—å –∑–µ–ª—å–µ (50 –∑–æ–ª–æ—Ç–∞)",
  "event": "buy_item",
  "params": {"item_id": "potion", "cost": 50},
  "next": "purchase_complete"
}
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è:**
```json
{
  "character": "–ö–≤–µ—Å—Ç–æ–¥–∞—Ç–µ–ª—å",
  "text": "–ó–∞–¥–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ!",
  "auto_events": ["start_quest:delivery", "add_item:package"],
  "choices": [...]
}
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π

```gdscript
func _ready():
	# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è
	DialogManager.register_event("buy_item", _on_buy_item)
	DialogManager.register_event("start_quest", _on_start_quest)

func _on_buy_item(params: Dictionary):
	var item_id = params.get("item_id", "")
	var cost = params.get("cost", 0)

	if player_gold >= cost:
		player_gold -= cost
		inventory.add_item(item_id)
		print("–ö—É–ø–ª–µ–Ω–æ: ", item_id)
	else:
		print("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!")

func _on_start_quest(params: Dictionary):
	var quest_id = params.get("quest_id", "")
	quest_system.start_quest(quest_id)
```

## üéÆ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–≥—Ä–æ–π

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ NPC –≤ —Å—Ü–µ–Ω—É

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π `NPCBase`:

```gdscript
extends NPCBase

func _ready():
	npc_display_name = "–ö—É–∑–Ω–µ—Ü"
	starting_dialog_id = "blacksmith_greeting"
	super._ready()
```

2. –î–æ–±–∞–≤—å—Ç–µ –≤ —Å—Ü–µ–Ω—É:
   - Node3D —Å –≤–∞—à–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º NPCBase
   - NPCDialogComponent –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª
   - CollisionShape3D –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–µ:
   - `npc_display_name` - –∏–º—è NPC
   - `starting_dialog_id` - ID –¥–∏–∞–ª–æ–≥–∞ –∏–∑ dialogs.json

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–∏—Å—Ç–µ–º–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

NPC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π `Interactable`:

- –ò–≥—Ä–æ–∫ –Ω–∞–≤–æ–¥–∏—Ç interact_ray –Ω–∞ NPC
- –ü–æ—è–≤–ª—è–µ—Ç—Å—è prompt "–ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å [–ò–º—è]"
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ E (`use` action) –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–º –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- –ö—É—Ä—Å–æ—Ä –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ–ø—Ü–∏–π

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–≥—Ä–æ–∫–∞ –≤–æ –≤—Ä–µ–º—è –¥–∏–∞–ª–æ–≥–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `player.set_movement_enabled(false)` –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –¥–∏–∞–ª–æ–≥–∞ –∏ `player.set_movement_enabled(true)` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Player:**
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à player.gd –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥:
```gdscript
func set_movement_enabled(enabled: bool) -> void:
	movement_enabled = enabled
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π —Ç–æ—Ä–≥–æ–≤–µ—Ü

```json
{
  "dialogs": {
	"merchant_greeting": {
	  "character": "–¢–æ—Ä–≥–æ–≤–µ—Ü",
	  "text": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ß—Ç–æ –∂–µ–ª–∞–µ—Ç–µ?",
	  "choices": [
		{
		  "text": "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã",
		  "next": "merchant_shop"
		},
		{
		  "text": "–î–æ —Å–≤–∏–¥–∞–Ω–∏—è",
		  "next": null
		}
	  ]
	},
	"merchant_shop": {
	  "character": "–¢–æ—Ä–≥–æ–≤–µ—Ü",
	  "text": "–í–æ—Ç –º–æ–∏ —Ç–æ–≤–∞—Ä—ã.",
	  "auto_events": ["open_shop_ui"],
	  "choices": [
		{
		  "text": "–ù–∞–∑–∞–¥",
		  "next": "merchant_greeting"
		}
	  ]
	}
  }
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ö–≤–µ—Å—Ç —Å —É—Å–ª–æ–≤–∏—è–º–∏

```json
{
  "dialogs": {
	"guard_checkpoint": {
	  "character": "–°—Ç—Ä–∞–∂",
	  "text": "–ü—Ä–æ—Ö–æ–¥ –∑–∞–∫—Ä—ã—Ç.",
	  "choices": [
		{
		  "text": "[–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–ø—É—Å–∫]",
		  "condition": "has_item:pass",
		  "next": "guard_let_pass",
		  "event": "remove_item",
		  "params": {"item_id": "pass"}
		},
		{
		  "text": "–Ø –≤–µ—Ä–Ω—É—Å—å –ø–æ–∑–∂–µ",
		  "next": null
		}
	  ]
	},
	"guard_let_pass": {
	  "character": "–°—Ç—Ä–∞–∂",
	  "text": "–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ.",
	  "auto_events": ["unlock_door:castle_gate"],
	  "choices": [
		{
		  "text": "–°–ø–∞—Å–∏–±–æ",
		  "next": null
		}
	  ]
	}
  }
}
```

### –ü—Ä–∏–º–µ—Ä 3: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π NPC

```gdscript
extends NPCBase

var quest_completed: bool = false

func _ready():
	npc_display_name = "–°—Ç–∞—Ä–µ–π—à–∏–Ω–∞"

	# –ú–µ–Ω—è–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
	if quest_completed:
		starting_dialog_id = "elder_thanks"
	else:
		starting_dialog_id = "elder_quest"

	super._ready()

	# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
	DialogManager.register_event("complete_quest", _on_quest_complete)

func _on_quest_complete(params: Dictionary):
	quest_completed = true
	print("–ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!")
```

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ [dialog_manager.gd:91-115](dialog_manager.gd#L91-L115):

```gdscript
func check_condition(condition: String) -> bool:
	var parts = condition.split(":")

	if parts.size() == 2:
		var type = parts[0]
		var value = parts[1]

		match type:
			"has_item":
				return check_has_item(value)
			"quest_active":
				return check_quest_active(value)
			"custom_condition":  # –í–∞—à–µ –Ω–æ–≤–æ–µ —É—Å–ª–æ–≤–∏–µ
				return check_custom_condition(value)

	# ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

### –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è UI

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ [dialog_UI.tscn](dialog_UI.tscn) –≤ Godot Editor:

- **DialogPanel** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å (–∏–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–º—É/—Ü–≤–µ—Ç)
- **CharacterName** - —Ü–≤–µ—Ç `Color(1, 0.85, 0.4, 1)`, —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ 24
- **DialogText** - RichTextLabel —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π BBCode
- **ChoicesContainer** - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ 8px

### –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ [dialog_ui.gd:21](dialog_ui.gd#L21):

```gdscript
func show_dialog(dialog_data: Dictionary):
	if dialog_data.is_empty():
		hide_dialog()
		return

	# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

	# –î–æ–±–∞–≤—å—Ç–µ –∞–Ω–∏–º–∞—Ü–∏—é
	dialog_panel.modulate.a = 0
	dialog_panel.show()

	var tween = create_tween()
	tween.tween_property(dialog_panel, "modulate:a", 1.0, 0.3)
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –î–∏–∞–ª–æ–≥ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `DialogManager` –≤ autoload (project.godot)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `dialogs.json` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON

### UI –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `dialog_UI.tscn` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å—Ü–µ–Ω—É —É—Ä–æ–≤–Ω—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Layer –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ UI (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ –∏–≥—Ä–æ–≤–æ–π —Å—Ü–µ–Ω—ã)

### –ò–≥—Ä–æ–∫ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ player.gd –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥ `set_movement_enabled()`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ NPC –≤ –≥—Ä—É–ø–ø–µ `Player` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `get_tree().get_first_node_in_group("Player")`

## üìö API Reference

### DialogManager

| –ú–µ—Ç–æ–¥ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –í–æ–∑–≤—Ä–∞—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----------|---------|----------|
| `start_dialog()` | `dialog_id: String` | `Dictionary` | –ó–∞–ø—É—Å–∫–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –ø–æ ID |
| `get_dialog()` | `dialog_id: String` | `Dictionary` | –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞ |
| `process_choice()` | `choice: Dictionary` | `Dictionary` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞ |
| `register_event()` | `event_name: String, handler: Callable` | `void` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è |
| `trigger_event()` | `event_name: String, params: Dictionary` | `void` | –í—ã–∑—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ |
| `check_condition()` | `condition: String` | `bool` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏–µ |

### NPCDialogComponent

| –ú–µ—Ç–æ–¥ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –í–æ–∑–≤—Ä–∞—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----------|---------|----------|
| `start_dialog()` | - | `void` | –ó–∞–ø—É—Å–∫–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —Å NPC |
| `on_player_interact()` | `player: Node` | `void` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ |
| `get_interaction_prompt()` | - | `String` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ |

## üé® –°–æ–≤–µ—Ç—ã –ø–æ –¥–∏–∑–∞–π–Ω—É –¥–∏–∞–ª–æ–≥–æ–≤

1. **–ö—Ä–∞—Ç–∫–æ—Å—Ç—å** - –¥–µ—Ä–∂–∏—Ç–µ —Ä–µ–ø–ª–∏–∫–∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
2. **–õ–∏—á–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π NPC –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Ä–µ—á–∏
3. **–í—ã–±–æ—Ä –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ** - –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã –≤–ª–∏—è—Ç—å –Ω–∞ –∏–≥—Ä—É
4. **–í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è** - –≤–∞–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤ –Ω–∞—á–∞–ª–µ —Å–ø–∏—Å–∫–∞
5. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ "Hasl" (Godot 4.5).

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-22
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** 1.0
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** Godot 4.5+
